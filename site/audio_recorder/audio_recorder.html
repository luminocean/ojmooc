<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <style>
        audio {
            vertical-align: bottom;
            width: 10em;
        }
    </style>
    <script src = "./library/RecordRTC.js"> </script>
    <script src = "./library/jquery-1.7.2.min.js"> </script>
</head>
<body>
    <section class="experiment">
        <h2 class="header">
            Record Audio
        </h2>

        <div class="inner" style="height: 50px;width: 700px">
            <audio id="audio" controls style="height: 50px;width: 300px"></audio>
            <button id="record-audio" style="height: 30px;width: 70px">Record</button>
            <button id="stop-recording-audio" disabled style="height: 30px;width: 70px">Stop</button>
            <h2 id="audio-url-preview"></h2>
        </div>
    </section>
    <script>
        function getByID(id) {
            return document.getElementById(id);
        }
            var recordAudio = getByID('record-audio'),
                stopRecordingAudio = getByID('stop-recording-audio');

            var audio = getByID('audio');

            var audioConstraints = {
                audio: true,
                video: false
            };
        </script>
        <script>
            var audioStream;
            var recorder;

            recordAudio.onclick = function() {
                if (!audioStream)
                    navigator.getUserMedia(audioConstraints, function(stream) {
                        if (window.IsChrome) stream = new window.MediaStream(stream.getAudioTracks());
                        audioStream = stream;

                        audio.src = URL.createObjectURL(audioStream);
                        audio.muted = true;
                        audio.play();

                        // "audio" is a default type
                        recorder = window.RecordRTC(stream, {
                            type: 'audio'
                        });
                        recorder.startRecording();
                    }, function() {
                    });
                else {
                    audio.src = URL.createObjectURL(audioStream);
                    audio.muted = true;
                    audio.play();
                    if (recorder) recorder.startRecording();
                }

                window.isAudio = true;

                this.disabled = true;
                stopRecordingAudio.disabled = false;
            };
            var screen_constraints;
            stopRecordingAudio.onclick = function() {
                this.disabled = true;
                recordAudio.disabled = false;
                audio.src = '';

                if (recorder)
                    recorder.stopRecording(function(url) {
                        audio.src = url;
                        audio.muted = false;
                        //audio.play();

                        document.getElementById('audio-url-preview').innerHTML = '<a href="' + url + '" target="_blank">Recorded Audio URL</a>';
                    });
            };
     </script>
</body>
</html>