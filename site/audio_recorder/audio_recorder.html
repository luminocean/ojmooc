<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>my audio recorder</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link href="./jPlayer-2.9.2/dist/skin/blue.monday/css/jplayer.blue.monday.min.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="./jPlayer-2.9.2/lib/jquery.min.js"></script>
    <script type="text/javascript" src="./jPlayer-2.9.2/dist/jplayer/jquery.jplayer.min.js"></script>
    <script src = "./library/RecordRTC.js"> </script>
    <script type="text/javascript">

        playaudio = function(audio_url) {
            //<![CDATA[
            $(document).ready(function () {

                $("#jquery_jplayer_1").jPlayer({
                    ready: function (event) {
                        $(this).jPlayer("setMedia", {
                            title: "",
                            mp3: audio_url
                        });
                    },
                    swfPath: "./jPlayer-2.9.2/dist/jplayer",
                    supplied: "m4a, oga, mp3",
                    wmode: "window",
                    useStateClassSkin: true,
                    autoBlur: false,
                    smoothPlayBar: true,
                    keyEnabled: true,
                    remainingDuration: true,
                    toggleDuration: true
                });
            });
            //]]>
        }
    </script>
</head>
<body>
<div id="jquery_jplayer_1" class="jp-jplayer"></div>
<div id="jp_container_1" class="jp-audio" role="application" aria-label="media player">
    <div class="jp-type-single">
        <div class="jp-gui jp-interface">
            <div class="jp-controls">
                <button class="jp-play" role="button" tabindex="0">play</button>
                <button class="jp-stop" role="button" tabindex="0">stop</button>
            </div>
            <div class="jp-progress">
                <div class="jp-seek-bar">
                    <div class="jp-play-bar"></div>
                </div>
            </div>
            <div class="jp-volume-controls">
                <button class="jp-mute" role="button" tabindex="0">mute</button>
                <button class="jp-volume-max" role="button" tabindex="0">max volume</button>
                <div class="jp-volume-bar">
                    <div class="jp-volume-bar-value"></div>
                </div>
            </div>
            <div class="jp-time-holder">
                <div class="jp-current-time" role="timer" aria-label="time">&nbsp;</div>
                <div class="jp-duration" role="timer" aria-label="duration">&nbsp;</div>
                <div class="jp-toggles">
                    <button class="jp-repeat" role="button" tabindex="0">repeat</button>
                </div>
            </div>
        </div>
        <div class="jp-details">
            <div class="jp-title" aria-label="title">&nbsp;</div>
        </div>
        <div class="jp-no-solution">
            <span>Update Required</span>
            To play the media you will need to either update your browser to a recent version or update your <a href="http://get.adobe.com/flashplayer/" target="_blank">Flash plugin</a>.
        </div>
    </div>
</div>

<div class="inner" style="height: 50px;width: 700px">
    <audio id="audio" style="height: 50px;width: 300px"></audio>
    <button id="record-audio" style="height: 30px;width: 70px;background-color: #87ceff">Record</button>
    <button id="stop-recording-audio" disabled style="height: 30px;width: 70px;background-color: #87ceff">Stop</button>
    <h2 id="audio-url-preview"></h2>
</div>

<script>
    function getByID(id) {
        return document.getElementById(id);
    }
    var recordAudio = getByID('record-audio'),
            stopRecordingAudio = getByID('stop-recording-audio');

    var audio = getByID('audio');

    var audioConstraints = {
        audio: true,
        video: false
    };
</script>
<script>
    var audioStream;
    var recorder;

    recordAudio.onclick = function() {
        if (!audioStream)
            navigator.getUserMedia(audioConstraints, function(stream) {
                if (window.IsChrome) stream = new window.MediaStream(stream.getAudioTracks());
                audioStream = stream;

                audio.src = URL.createObjectURL(audioStream);
                audio.muted = true;
                audio.play();

                // "audio" is a default type
                recorder = window.RecordRTC(stream, {
                    type: 'audio'
                });
                recorder.startRecording();
            }, function() {
            });
        else {
            audio.src = URL.createObjectURL(audioStream);
            audio.muted = true;
            audio.play();
            if (recorder) recorder.startRecording();
        }

        window.isAudio = true;

        this.disabled = true;
        stopRecordingAudio.disabled = false;
    };
    var screen_constraints;
    stopRecordingAudio.onclick = function() {
        this.disabled = true;
        recordAudio.disabled = false;
        audio.src = '';

        if (recorder)
            recorder.stopRecording(function(url) {
                audio.src = url;
                audio.muted = false;
                playaudio(url);
                document.getElementById('audio-url-preview').innerHTML = '<a href="' + url + '" target="_blank">Recorded Audio URL</a>';
            });
    };
</script>
</body>

</html>
