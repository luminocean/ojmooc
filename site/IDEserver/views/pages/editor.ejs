<!-- views/pages/editor.ejs -->
<!DOCTYPE html>
<html lang="en">

<head>
    <% include ../partials/head %>
    <link rel="stylesheet" href="/stylesheets/editorStyle.css">
    <script type="text/javascript" src="/scripts/aceJS/ace.js"></script>
</head>

<body class="container" onbeforeunload="check()">

<header>
    <% include ../partials/header %>
</header>

<main>
    <div class="row">
        <div class="col-sm-8">
            <div id="optionPanel" class="col-sm-10">
                <table>
                    <tr>
                        <td>
                            <label>大小</label>
                            <select id="fontsize" size="1">
                                <option value="11px">11px</option>
                                <option value="12px" selected="selected">12px</option>
                                <option value="13px">13px</option>
                                <option value="14px">14px</option>
                            </select>
                        </td>
                        <td>
                            <label>语言</label>
                            <select id="language" size="1">
                                <option value="cpp" selected="selected">C/C++</option>
                                <option value="pas">pascal</option>
                                <option value="bas">Qbasic</option>
                            </select>
                        </td>
                        <td>
                            <input type="submit" id="run" value="运行">
                            <input type="submit" id="debugBegin" value="开始调试">
                        </td>
                        <td>
                            <input type="submit" id="debugInto" value="调试">
                            <input type="submit" id="debugOut" value="退出调试">
                        </td>
                    </tr>
                </table>
            </div>

            <div id="leftPanel" class="col-sm-3">
                <div id="variable" class="panel panel-info col-sm-12 debugInfoPanel">
                    <div class="panel-heading">变量</div>
                    <table class="table">
                        <tr>
                            <td>a</td>
                            <td>10</td>
                        </tr>
                    </table>
                </div>
                <div id="operate" class="panel panel-info col-sm-12 debugInfoPanel">
                    <div class="panel-heading">操作</div>
                    <table class="table">
                        <tr>
                            <td>a</td>
                            <td>10</td>
                        </tr>
                    </table>
                </div>
            </div>

            <div id="midPanel" class="col-sm-10">
                <div id="editor" class="col-sm-12">
                </div>
                <div id="inputEditor" class="col-sm-6">
                </div>
                <div id="outputEditor" class="col-sm-6">
                </div>
            </div>

            <div id="rightPanel" class="col-sm-3">
                <div id="breakpoint" class="panel panel-info col-sm-12 debugInfoPanel">
                    <div class="panel-heading">断点</div>
                    <table class="table">
                        <tr>
                            <td>a</td>
                            <td>10</td>
                        </tr>
                    </table>
                </div>
                <div id="stack" class="panel panel-info col-sm-12 debugInfoPanel">
                    <div class="panel-heading">堆栈</div>
                    <table class="table">
                        <tr>
                            <td>a</td>
                            <td>10</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <div class="col-sm-4">
            <div class="well">
                <h3>Look I'm A Sidebar!</h3>
            </div>
        </div>

    </div>
</main>

<footer>
    <% include ../partials/footer %>
</footer>
</body>
<script>

    $(document).ready(function () {
        $("#leftPanel").hide();
        $("#rightPanel").hide();
        $("#debugBegin").hide();
        $("#debugOut").hide();

        var inputEditor = ace.edit("inputEditor");
        var outputEditor = ace.edit("outputEditor");
        var editor = ace.edit("editor");

        inputEditor.setTheme("ace/theme/twilight");
        outputEditor.setTheme("ace/theme/twilight");
        outputEditor.setReadOnly(true);
        editor.setTheme("ace/theme/monokai");
        editor.getSession().setMode("ace/mode/c_cpp");
    });

    $("#fontsize").change(function () {
        var size = $("#fontsize").val();
        $("#editor").css("font-size", size);

    })

    $("#language").change(function () {
        var session = ace.edit("editor").getSession();
        var lan = $("#language").val();

        switch (lan) {
            case "cpp":
                session.setMode("ace/mode/c_cpp");
                break;
            case "pas":
                session.setMode("ace/mode/pascal");
                break;
            case "bas":
                session.setMode("ace/mode/qbasic");
                break;
            case "default":
                break;
        }
    })

    function check() {
        $("#fontsize").val("12px");
        $("#language").val("cpp");
    }

    $("#run").click(function () {
        var editor = ace.edit("editor");
        var inputEditor = ace.edit("inputEditor");
        var outputEditor = ace.edit("outputEditor");

        var code = editor.getValue();
        var lan = $("#language").val();
        var params = inputEditor.getValue().trim();

        $.ajax({
            type: "POST",
            url: "/IDE/handle",
            data: {code: code, language: lan, params: params},
            dataType: "text",
            success: function (result) {
                outputEditor.setValue(result);
            },
            error: function () {
                outputEditor.setValue("Error:can not connect to the server!");
            }
        });
    });

    $("#debugInto").click(function () {
        $("#midPanel").removeClass("col-sm-10").addClass("col-sm-6");
        $("#leftPanel").show();
        $("#rightPanel").show();

        $("#debugBegin").show();
        $("#debugOut").show();
        $("#debugInto").hide();
        $("#run").hide();
    });

    $("#debugOut").click(function () {
        $("#midPanel").removeClass("col-sm-6").addClass("col-sm-10");
        $("#leftPanel").hide();
        $("#rightPanel").hide();

        $("#debugBegin").hide();
        $("#debugOut").hide();
        $("#debugInto").show();
        $("#run").show();
    })


</script>
</html>