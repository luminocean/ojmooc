<!-- views/pages/IDE.ejs -->
<!DOCTYPE html>
<html lang="en">

<head>
    <% include ../partials/head %>
    <link rel="stylesheet" href="/stylesheets/editorStyle.css">
    <script type = "text/javascript" src="/scripts/aceJS/ace.js"></script>
</head>

<body class="container" onbeforeunload="check()">

<header>
    <% include ../partials/header %>
</header>

<main>
    <div class="row">
        <div class="col-sm-8">
            <div id="optionPanel">
                <table>
                    <tr>
                        <td>
                            <label>fontsize:</label>
                            <select id="fontsize" size="1">
                                <option value="11px">11px</option>
                                <option value="12px" selected="selected">12px</option>
                                <option value="13px">13px</option>
                                <option value="14px">14px</option>
                            </select>
                        </td>
                        <td>
                            <label>language:</label>
                            <select id="language" size="1">
                                <option value="cpp" selected = "selected">C/C++</option>
                                <option value="pas">pascal</option>
                                <option value="bas">Qbasic</option>
                            </select>
                        </td>
                        <td>
                            <input type="submit" id="run" value="RUN">
                        </td>
                        <td>
                            <input type="submit" id="debug" value="DEBUG">
                        </td>
                    </tr>
                </table>
            </div>
            <div id="editor">
            </div>
            <div id="inputEditor"><p>hello,this is a test</p>
            </div>
            <div id="outputEditor">
            </div>
        </div>

        <div class="col-sm-4">
            <div class="well">
                <h3>Look I'm A Sidebar!</h3>
            </div>
        </div>

    </div>
</main>

<footer>
    <% include ../partials/footer %>
</footer>
</body>
<script>
    $("#fontsize").change(function(){
        var size = $("#fontsize").val();
        $("#editor").css("font-size",size);

    })

    $("#language").change(function(){
        var editor = ace.edit("editor");
        var lan = $("#language").val();
        switch (lan){
            case "cpp":
                editor.getSession().setMode("ace/mode/c_cpp");
                break;
            case "pas":
                editor.getSession().setMode("ace/mode/pascal");
                break;
            case "bas":
                editor.getSession().setMode("ace/mode/qbasic");
                break;
            case "default":
                break;
        }
    })

    function check(){
        $("#fontsize").val("12px");
        $("#language").val("cpp");
    }

    $("#run").click(function () {
        var editor = ace.edit("editor");
        var inputEditor = ace.edit("inputEditor");
        var outputEditor = ace.edit("outputEditor");

        var code = editor.getValue();
        var lan = $("#language").val();
        var params = inputEditor.getValue().trim();

        $.ajax({
            type:"POST",
            url:"/IDE/handle",
            data:{code:code,language:lan,params:params},
            dataType:"text",
            success:function(result) {
                outputEditor.setValue(result);
            },
            error : function() {
                outputEditor.setValue("Error:can not connect to the server!");
            }
        });
    });

    var inputEditor = ace.edit("inputEditor");
    var outputEditor = ace.edit("outputEditor");
    var editor = ace.edit("editor");

    inputEditor.setTheme("ace/theme/twilight");
    outputEditor.setTheme("ace/theme/twilight");
    editor.setTheme("ace/theme/monokai");
    editor.getSession().setMode("ace/mode/c_cpp");
</script>
</html>